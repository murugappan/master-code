/*
Author: Nikhil Kumar
Date:   July 2013
Descr:  This is the test class for the CPQ operations in BbOpportunityTriggerHandler


ChangeLog:
2013-09-20: [LaL]  There are failures now.


System.DmlException: Update failed. First exception on row 0 with id 006V0000004GJZMIA4; first error: CANNOT_INSERT_UPDATE_ACTIVATE_ENTITY, BbOpportunityTrigger: execution of AfterUpdate

caused by: System.DmlException: Upsert failed. First exception on row 1; first error: PRIVATE_CONTACT_ON_ASSET, Cannot parent an asset to an unparented contact: []

Class.BbOpportunityTriggerHandler.CPQRenewalCreation: line 2663, column 1
Class.BbOpportunityTriggerHandler.OnAfterUpdate: line 168, column 1
Trigger.BbOpportunityTrigger: line 19, column 1: []

*/

//Test case for CPQRenewalCreation Trigger

@isTest(seeAllData=true)
private class CPQRenewalCreationTest {

    static testMethod void myUnitTestNew() {
    
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ New Sales Opportunity Record Type'];
    Id renewId, newId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
        newId = recordtypes[0].Id;
    }     
    
        // Initialize (creation of fake object needed for the test)
       String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
       String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        List<OpportunityTeamMember> oppteam = new List<OpportunityTeamMember> (); 
        List<OpportunityShare> sharesToCreate = new List<OpportunityShare>();
        List<Contact_Role__c> contactRolesCreate = new List<Contact_Role__c>();
        List<Contact_Role_Selector__c> contactSelectorCreate = new List<Contact_Role_Selector__c>(); 
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Start_Date__c=System.now().date(),End_Date__c=System.now().date()+365,Name=oppName,CloseDate=System.now().date(),StageName='(E) Sponsor Qualification',AccountId=accNew.Id,RecordTypeId=newId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;
       
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
               
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
       
        //update quoteContent;
        System.test.startTest();
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;     
        
        Contact testContact = new Contact(LastName='Person',AccountId=accNew.Id);
        insert testContact;
               
        //Insert 2 Contact Roles/Selectors to the Opportunity
        Contact_Role__c cr1 = new Contact_Role__c(Account__c= accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Contact');
        contactRolesCreate.add(cr1);
        
        Contact_Role__c cr2 = new Contact_Role__c(Account__c = accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Technical Contact');
        contactRolesCreate.add(cr2);
        insert contactRolesCreate;
        
        Contact_Role_Selector__c crs1 = new Contact_Role_Selector__c(Opportunity__c=oppNew.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate.add(crs1);
        
        Contact_Role_Selector__c crs2 = new Contact_Role_Selector__c(Opportunity__c=oppNew.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate.add(crs2);
        insert contactSelectorCreate;
        
        User[] testUser = [SELECT Id FROM User where isActive = true limit 2];
         
        OpportunityTeamMember oppMem1 = new OpportunityTeamMember(OpportunityId = oppNew.Id,TeamMemberRole = 'New Sale Representative');
        oppMem1.UserId = testUser[0].Id;
        oppteam.add(oppMem1);
         
        OpportunityTeamMember oppMem2 = new OpportunityTeamMember(OpportunityId = oppNew.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem2.UserId = testUser[1].Id;
        oppteam.add(oppMem2);        
        insert oppteam;
        
        //test Renewal creation
        oppNew.StageName='(W) Won';
        oppNew.Won_from__c='No Competitor';
        oppNew.CPQ_PO_Required__c='No';
        oppNew.Closed_Loss_Won_Reason__c='Budget';
        
        //update oppNew;
                
        System.test.stopTest();
    }
    
    static testMethod void myUnitTestRenewal() {
    
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }     
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        List<OpportunityTeamMember> oppteam = new List<OpportunityTeamMember> (); 
        List<OpportunityShare> sharesToCreate = new List<OpportunityShare>();
        List<Contact_Role__c> contactRolesCreate = new List<Contact_Role__c>();
        List<Contact_Role_Selector__c> contactSelectorCreate = new List<Contact_Role_Selector__c>();
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;    
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        Asset astNew = new Asset(Name='CL-TRNOL-GS-WC',CPQ_isMultiyear__c=true,CPQ_Net_Price__c=2,CurrencyIsoCode='USD',Description='testAsset',CPQ_Contract_End_Date__c=date.newinstance(2013, 2, 14),CPQ_Contract_Start_Date__c=date.newinstance(2012, 2, 15),AccountId=accNew.Id,CPQ_isRenewable__c=true,Status='Installed',CPQ_forCPQ__c=true,Price=1,Psft_Product_Id__c=prodName,Product2Id=prod.Id,CPQ_Current_Opportunity_ID__c='006S0000006ou5kIAA',CPQ_currentYear__c=1,CPQ_contractLength__c=2,CPQ_NumQty__c=1,CPQ_LineIdentifier__c='145',CPQ_Active__c=true,CPQ_Selling_Exchange_Rate__c=1);
        insert astNew;
               
        //create renewal sales opp for testing
        Opportunity oppRen=new Opportunity(Name=oppName,Start_Date__c=date.newinstance(2013, 2, 15),End_Date__c=date.newinstance(2014, 2, 14),RecordTypeId=renewId,CloseDate=System.now().date(),CPQ_Previous_Opportunity__c='006S0000006ou5kIAA',CPQ_Products_for_Realignment__c='145.006S0000006ou5kIAA',StageName='(S) Suspect Qualification',AccountId=accNew.Id,Type='Renewal',Multi_Year_Deal__c='2 Year');
        insert oppRen;
        
        List<OpportunityLineItem> allOli = new List<OpportunityLineItem>();
                   
         //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppRen.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
        System.test.startTest();
         
        //update quoteContent;
        
        oppRen.CPQActiveRelease__c=quote.Id;
        update oppRen;
        Contact testContact = new Contact(LastName='Person');
        insert testContact;
        
        //Insert 2 Contact Roles/Selectors to the Opportunity
        Contact_Role__c cr1 = new Contact_Role__c(Account__c= accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Contact');
        contactRolesCreate.add(cr1);
        
        Contact_Role__c cr2 = new Contact_Role__c(Account__c = accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Technical Contact');
        contactRolesCreate.add(cr2);
        insert contactRolesCreate;
        
        Contact_Role_Selector__c crs1 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate.add(crs1);
        
        Contact_Role_Selector__c crs2 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate.add(crs2);
        insert contactSelectorCreate;
        
        User[] testUser = [SELECT Id FROM User where isActive = true limit 2];
        
        /*OpportunityShare oshare1 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[0].Id);
        sharesToCreate.add(oshare1);
        
        OpportunityShare oshare2 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[1].Id);
        sharesToCreate.add(oshare2);
        
        insert sharesToCreate;*/
         
        OpportunityTeamMember oppMem1 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'New Sale Representative');
        oppMem1.UserId = testUser[0].Id;
        oppteam.add(oppMem1);
         
        OpportunityTeamMember oppMem2 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem2.UserId = testUser[1].Id;
        oppteam.add(oppMem2);        
        insert oppteam;
        
        oppRen.StageName='(W) Won';
        oppRen.Won_from__c='No Competitor';
        oppRen.CPQ_PO_Required__c='No';
        oppRen.Closed_Loss_Won_Reason__c='Budget';
                
      //  update oppRen;
               
        System.test.stopTest();
    }
    
    static testMethod void myUnitTestRenewalMY() {
    
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }     
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
         String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        List<OpportunityTeamMember> oppteam = new List<OpportunityTeamMember> (); 
        List<OpportunityShare> sharesToCreate = new List<OpportunityShare>();
        List<Contact_Role__c> contactRolesCreate = new List<Contact_Role__c>();
        List<Contact_Role_Selector__c> contactSelectorCreate = new List<Contact_Role_Selector__c>(); 
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;    
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        Asset astNew = new Asset(Name='CL-TRNOL-GS-WC',CPQ_isMultiyear__c=true,CPQ_Net_Price__c=2,CurrencyIsoCode='USD',Description='testAsset',CPQ_Contract_End_Date__c=date.newinstance(2013, 2, 14),CPQ_Contract_Start_Date__c=date.newinstance(2012, 2, 15),AccountId=accNew.Id,CPQ_isRenewable__c=true,Status='Installed',CPQ_forCPQ__c=true,Price=1,Psft_Product_Id__c=prodName,Product2Id=prod.Id,CPQ_Current_Opportunity_ID__c='006S0000006ou5kIAA',CPQ_currentYear__c=1,CPQ_contractLength__c=2,CPQ_NumQty__c=1,CPQ_LineIdentifier__c='145',CPQ_Active__c=true,CPQ_Selling_Exchange_Rate__c=1);
        insert astNew;
               
        //create renewal sales opp for testing
        Opportunity oppRen=new Opportunity(Name=oppName,Start_Date__c=date.newinstance(2013, 2, 15),End_Date__c=date.newinstance(2014, 2, 14),RecordTypeId=renewId,CloseDate=System.now().date(),CPQ_Previous_Opportunity__c='006S0000006ou5kIAA',CPQ_Products_for_Realignment__c='145.006S0000006ou5kIAA',StageName='(S) Suspect Qualification',AccountId=accNew.Id,Type='Renewal',Multi_Year_Deal__c='3 Year');
        insert oppRen;
        
        List<OpportunityLineItem> allOli = new List<OpportunityLineItem>();
        
                      
         //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppRen.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;        
        System.test.startTest();
        //update quoteContent;
        
        oppRen.CPQActiveRelease__c=quote.Id;
        update oppRen;
        Contact testContact = new Contact(LastName='Person');
        insert testContact;
       
        //Insert 2 Contact Roles/Selectors to the Opportunity
        Contact_Role__c cr1 = new Contact_Role__c(Account__c= accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Contact');
        contactRolesCreate.add(cr1);
        
        Contact_Role__c cr2 = new Contact_Role__c(Account__c = accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Technical Contact');
        contactRolesCreate.add(cr2);
        insert contactRolesCreate;
        
        Contact_Role_Selector__c crs1 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate.add(crs1);
        
        Contact_Role_Selector__c crs2 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate.add(crs2);
        insert contactSelectorCreate;
        
        User[] testUser = [SELECT Id FROM User where isActive = true limit 2];
        
        /*OpportunityShare oshare1 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[0].Id);
        sharesToCreate.add(oshare1);
        
        OpportunityShare oshare2 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[1].Id);
        sharesToCreate.add(oshare2);
        
        insert sharesToCreate;*/
         
        OpportunityTeamMember oppMem1 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'New Sale Representative');
        oppMem1.UserId = testUser[0].Id;
        oppteam.add(oppMem1);
         
        OpportunityTeamMember oppMem2 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem2.UserId = testUser[1].Id;
        oppteam.add(oppMem2);        
        insert oppteam;
        
        
        oppRen.StageName='(W) Won';
        oppRen.Won_from__c='No Competitor';
        oppRen.CPQ_PO_Required__c='No';
        oppRen.Closed_Loss_Won_Reason__c='Budget';
                
       // update oppRen;
               
        System.test.stopTest();
    }
    
    static testMethod void myUnitTestDeleteNew() {
 
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ New Sales Opportunity Record Type'];
    Id renewId, newId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
        newId = recordtypes[0].Id;
    }     
    
       // Initialize (creation of fake object needed for the test)
       String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
       String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Name=oppName,CloseDate=System.now().date(),StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=newId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;
      
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
       
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
            
        //test delete trigger
        System.test.startTest();
        //update quoteContent;
        
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;
                

        delete quote;
        System.test.stopTest();
    }
    
    static testMethod void myUnitTestDeleteRenewal() {
        
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }     
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml ='<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;        
       
         //create renewal sales opp for testing
        Opportunity oppRen=new Opportunity(Name=oppName,CloseDate=System.now().date(),StageName='(S) Suspect Qualification',AccountId=accNew.Id,Type='Renewal',Multi_Year_Deal__c='3 Year');
        insert oppRen;
        
        oppRen.RecordTypeId=renewId;
        update oppRen;
                   
         //create quote - new sales
        CameleonCPQ__Quote__c renQuote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppRen.Id);
        insert renQuote;
        
        CameleonCPQ__QuoteContent__c renQuoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = renQuote.Id);
        insert renQuoteContent;
        
        
        Attachment renAttachment = new Attachment(Name = attName, parentId = renQuoteContent.Id);
        renAttachment.Body = Blob.valueOf(quoteXml);
        insert renAttachment;
        
        System.test.startTest();
        
        //update renQuoteContent;
        oppRen.CPQActiveRelease__c=renQuote.Id;
        update oppRen;   
        
        //test delete trigger
        
        delete renQuote;
        System.test.stopTest();
    }
    
     static testMethod void myUnitTestQuoteStatusNew() {        
 
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ New Sales Opportunity Record Type'];
    Id renewId, newId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
        newId = recordtypes[0].Id;
    }       
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
       String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
        Pricebook2 spb = [select Id from Pricebook2 where IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        PricebookEntry pbe2 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        insert pbe2;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Name=oppName,CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=newId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;
      
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
      
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
        //test statuses trigger
        System.test.startTest();
        
        //update quoteContent;
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;
        
        
        oppNew.CPQ_Quote_Status__c='Approved Price Quote';
        update oppNew;
        
        oppNew.CPQ_Quote_Status__c='Quote Rejected';
        update oppNew;
        
        oppNew.CPQ_Quote_Status__c=null;
        update oppNew;
        System.test.stopTest();
    }
    static testMethod void myUnitTestQuoteStatusRenew() {       
 
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }    
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
       String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
        Pricebook2 spb = [select Id from Pricebook2 where IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        PricebookEntry pbe2 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe2;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Name=oppName,CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=renewId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;
      
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
        
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;
                
        //test statuses trigger
        System.test.startTest();
        //update quoteContent;

        oppNew.CPQ_Quote_Status__c='Approved Price Quote';
        update oppNew;
        
        oppNew.CPQ_Quote_Status__c='Quote Rejected';
        update oppNew;
        
        oppNew.CPQ_Quote_Status__c=null;
        update oppNew;
        System.test.stopTest();
    }
    static testMethod void myUnitTestAlignment() {       
 
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }    
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String opp2 = 'TEST_OPP2';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        String prodName2 = 'CL-TRNOL-GS-WCAL';
        List<OpportunityTeamMember> oppteam = new List<OpportunityTeamMember> (); 
        List<OpportunityShare> sharesToCreate = new List<OpportunityShare>();
        List<Contact_Role__c> contactRolesCreate = new List<Contact_Role__c>();
        List<Contact_Role_Selector__c> contactSelectorCreate = new List<Contact_Role_Selector__c>(); 
          
        
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
        Pricebook2 spb = [select Id from Pricebook2 where IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        Product2 prod2 = new Product2(Name = prodName2, ProductCode = prodName2);
        insert prod;
        insert prod2;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        PricebookEntry pbe3 = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod2.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        insert pbe3;
        
        PricebookEntry pbe2 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        PricebookEntry pbe4 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod2.Id, UnitPrice = 2, IsActive = true);
        insert pbe2;
        insert pbe4;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Name=oppName,CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=renewId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;      
        
        //create new New Sales Opportunity
        Opportunity oppNewAl=new Opportunity(Name=oppName,CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,CPQ_Previous_Opportunity__c=oppNew.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=renewId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNewAl;   
       
        OpportunityLineItem oli = new OpportunityLineItem(OpportunityId=oppNewAl.Id,Quantity=1,CPQ_Previous_Opportunity__c=oppNew.Id,PricebookEntryId=pbe4.Id,Renewal_Unique_Line_ID__c='145',CPQ_Product_Status__c='Renewal',Custom_Price__c=0);
        insert oli; 
        
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteXml);
        insert attachment;
        Contact testContact = new Contact(LastName='Person');
        insert testContact;
        
        //Insert 2 Contact Roles/Selectors to the Opportunity
        Contact_Role__c cr1 = new Contact_Role__c(Account__c= accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Contact');
        contactRolesCreate.add(cr1);
        
        Contact_Role__c cr2 = new Contact_Role__c(Account__c = accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Technical Contact');
        contactRolesCreate.add(cr2);
        insert contactRolesCreate;
        
        Contact_Role_Selector__c crs1 = new Contact_Role_Selector__c(Opportunity__c=oppNew.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate.add(crs1);
        
        Contact_Role_Selector__c crs2 = new Contact_Role_Selector__c(Opportunity__c=oppNew.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate.add(crs2);
        insert contactSelectorCreate;
        
        User[] testUser = [SELECT Id FROM User where isActive = true limit 2];
        
        /*OpportunityShare oshare1 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[0].Id);
        sharesToCreate.add(oshare1);
        
        OpportunityShare oshare2 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[1].Id);
        sharesToCreate.add(oshare2);
        
        insert sharesToCreate;*/
         
        OpportunityTeamMember oppMem1 = new OpportunityTeamMember(OpportunityId = oppNew.Id,TeamMemberRole = 'New Sale Representative');
        oppMem1.UserId = testUser[0].Id;
        oppteam.add(oppMem1);
         
        OpportunityTeamMember oppMem2 = new OpportunityTeamMember(OpportunityId = oppNew.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem2.UserId = testUser[1].Id;
        oppteam.add(oppMem2);        
        insert oppteam;
        
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;
                
        //test adding alignment
       
        System.test.startTest();
       // update quoteContent;       
        
        oppNew.StageName='(W) Won';
        oppNew.Won_from__c='No Competitor';
        oppNew.CPQ_PO_Required__c='No';
        oppNew.Closed_Loss_Won_Reason__c='Budget';
                
      //  update oppNew;    

        System.test.stopTest();
    }
    
    static testMethod void myUnitTestRemoveAlignment() {       
 
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }    
    
        // Initialize (creation of fake object needed for the test)
        String pricebookName = 'TEST_PB';
        String quoteNoAlign = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String opp2 = 'TEST_OPP2';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        String prodName2 = 'CL-TRNOL-GS-WCAL';
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;
        
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
        Pricebook2 spb = [select Id from Pricebook2 where IsStandard=true LIMIT 1]; 
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        Product2 prod2 = new Product2(Name = prodName2, ProductCode = prodName2);
        insert prod;
        insert prod2;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        PricebookEntry pbe3 = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod2.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        insert pbe3;
        
        PricebookEntry pbe2 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        PricebookEntry pbe4 = new PricebookEntry(Pricebook2Id = cpqPb.Id, Product2Id = prod2.Id, UnitPrice = 2, IsActive = true);
        insert pbe2;
        insert pbe4;
        
        //create new New Sales Opportunity
        Opportunity oppNew=new Opportunity(Name=oppName,CPQ_Products_for_Realignment__c='145.006S0000006ou5kIAA',CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=renewId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppNew;
        
        Opportunity oppReAl=new Opportunity(Name=oppName,CloseDate=System.now().date(),Pricebook2Id = cpqPb.Id,CPQ_Previous_Opportunity__c=oppNew.id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,RecordTypeId=renewId,Type='Renewal',Multi_Year_Deal__c='No');
        insert oppReAl;        
        
        OpportunityLineItem oli = new OpportunityLineItem(OpportunityId=oppReAl.Id,Quantity=1,CPQ_Previous_Opportunity__c=oppNew.id, PricebookEntryId=pbe4.Id,Renewal_Unique_Line_ID__c='145',CPQ_Product_Status__c='Realigned',Custom_Price__c=0);
        insert oli;        
        
        //create quote - new sales
        CameleonCPQ__Quote__c quote = new CameleonCPQ__Quote__c(Name = quoteName, OpportunityId__c = oppNew.Id);
        insert quote;
        
        CameleonCPQ__QuoteContent__c quoteContent = new CameleonCPQ__QuoteContent__c(CameleonCPQ__QuoteId__c = quote.Id);
        insert quoteContent;
        
        Attachment attachment = new Attachment(Name = attName, parentId = quoteContent.Id);
        attachment.Body = Blob.valueOf(quoteNoAlign);
        insert attachment;
        
        oppNew.CPQActiveRelease__c=quote.Id;
        update oppNew;
        
         //create quote - new sales
             
        //test removing alignment
        System.test.startTest();
       // update quoteContent;    
        System.test.stopTest();
    } 
    static testMethod void myUnitTestAssets() {
    
    //get recordtype id for renewal type, do request outside loop since it is static info
    RecordType[] recordtypes = [SELECT Id, Name FROM RecordType WHERE Name='CPQ Renewal Opportunity Record Type'];
    Id renewId;
    
    Recordtype rec =[Select id,Name from Recordtype Where Name='CPQ New Sales Opportunity Record Type' limit 1];
 
    //store record type ids, different logic for asset creation based on if opportunity is a reenewal, or a new sales
    if(recordtypes.size() > 0){
       renewId=recordtypes[0].Id;
    }     
    
        // Initialize (creation of fake object needed for the test)
        String quoteXml = '<?xml version="1.0" encoding="UTF-8"?><cart domain="00DS0000001D68pMAC" id="a35S0000001YzKoIAK" release="1" type="C"><modelPK id="CPQModel_Blackboard" release="1"/><createInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><updateInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121130 100533"/><ownerInfo userID="005S0000003jTliIAE" groupID="System Administrator" userName="Maxime Feron" date="20121129 150622"/><activeInfo active="on" date="20121129 150622"/><statusInfo status="SubmittedForApproval" date="20121129 150622"/><fields><ParameterTab.DomainId>00DS0000001D68pMAC</ParameterTab.DomainId><ParameterTab.ReleaseNumber>1</ParameterTab.ReleaseNumber><ParameterTab.QuoteId>a35S0000001YzKoIAK</ParameterTab.QuoteId><ParameterTab.CustomerId/><ParameterTab.Language>US</ParameterTab.Language><ParameterTab.Currency>USD</ParameterTab.Currency><ParameterTab.QuoteDescription>MaximeTestRenew</ParameterTab.QuoteDescription><ParameterTab.ApplicationDate/><ParameterTab.PriceList/><ParameterTab.AdvPriceList/><ParameterTab.PartnerCode/><ParameterTab.UserCode/><ParameterTab.LeadId/><ParameterTab.ParentAccountId/><ParameterTab.ExternalId/><AddressTab.SoldTo.CustomerId>345182</AddressTab.SoldTo.CustomerId><AddressTab.SoldTo.CustomerName>Cranleigh School</AddressTab.SoldTo.CustomerName><AddressTab.SoldTo.Address1/><AddressTab.SoldTo.ContactName/><AddressTab.SoldTo.Address2/><AddressTab.SoldTo.Phone/><AddressTab.SoldTo.Fax/><AddressTab.SoldTo.Address3/><AddressTab.SoldTo.eMail/><AddressTab.SoldTo.City>Cranleigh</AddressTab.SoldTo.City><AddressTab.SoldTo.ZipCode>GU6 8QQ</AddressTab.SoldTo.ZipCode><AddressTab.SoldTo.State/><AddressTab.SoldTo.Country>United Kingdom</AddressTab.SoldTo.Country><AddressTab.BillTo.CustomerId>345182</AddressTab.BillTo.CustomerId><AddressTab.BillTo.CustomerName>Cranleigh School</AddressTab.BillTo.CustomerName><AddressTab.BillTo.Address1/><AddressTab.BillTo.ContactName/><AddressTab.BillTo.Address2/><AddressTab.BillTo.Phone/><AddressTab.BillTo.Fax/><AddressTab.BillTo.Address3/><AddressTab.BillTo.eMail/><AddressTab.BillTo.City>Cranleigh</AddressTab.BillTo.City><AddressTab.BillTo.ZipCode>GU6 8QQ</AddressTab.BillTo.ZipCode><AddressTab.BillTo.State/><AddressTab.BillTo.Country>United Kingdom</AddressTab.BillTo.Country><AddressTab.ShipTo.CustomerId>345182</AddressTab.ShipTo.CustomerId><AddressTab.ShipTo.CustomerName>Cranleigh School</AddressTab.ShipTo.CustomerName><AddressTab.ShipTo.Address1/><AddressTab.ShipTo.ContactName/><AddressTab.ShipTo.Address2/><AddressTab.ShipTo.Phone/><AddressTab.ShipTo.Fax/><AddressTab.ShipTo.Address3/><AddressTab.ShipTo.eMail/><AddressTab.ShipTo.City>Cranleigh</AddressTab.ShipTo.City><AddressTab.ShipTo.ZipCode>GU6 8QQ</AddressTab.ShipTo.ZipCode><AddressTab.ShipTo.State/><AddressTab.ShipTo.Country>United Kingdom</AddressTab.ShipTo.Country><CartInfoTab.UserFirstName/><CartInfoTab.ExchangeRate>1</CartInfoTab.ExchangeRate><CartInfoTab.UserMail/><CartInfoTab.UserLastName/><CartInfoTab.UserPhone/><CartInfoTab.HQQuotedAmount/><CartInfoTab.ContractStartDate/><CartInfoTab.ContractDuration/><CartInfoTab.CollaborateVBR>1000,3000,1500,500,0,3,2,100</CartInfoTab.CollaborateVBR><CartInfoTab.MoodleroomsVBR>400,500,600,700,800,9,11,1000</CartInfoTab.MoodleroomsVBR><CartInfoTab.AnalyticsVBR>1200,1300,1400,1500,1600,17,19,1800</CartInfoTab.AnalyticsVBR><CartInfoTab.NetSpotVBR>2000,2100,2200,2300,2400,25,27,2600</CartInfoTab.NetSpotVBR><OrderInfoTab.HOQuotedAmount/><OrderInfoTab.OrderId/><OrderInfoTab.PaymentNum/><OrderInfoTab.Opportunity_Number_new>CL-0333740</OrderInfoTab.Opportunity_Number_new><ChangeAndControlTab.CurrentActiveRelease>1</ChangeAndControlTab.CurrentActiveRelease><ChangeAndControlTab.DateActiveRelease>20121129 150622</ChangeAndControlTab.DateActiveRelease><ChangeAndControlTab.CurrentStatus>SubmittedForApproval</ChangeAndControlTab.CurrentStatus><ChangeAndControlTab.DateStatus>20121129 150622</ChangeAndControlTab.DateStatus><ChangeAndControlTab.CurrentOwnerId>005S0000003jTliIAE</ChangeAndControlTab.CurrentOwnerId><ChangeAndControlTab.CurrentOwnerName>Maxime Feron</ChangeAndControlTab.CurrentOwnerName><ChangeAndControlTab.CurrentOwnerGroup>System Administrator</ChangeAndControlTab.CurrentOwnerGroup><ChangeAndControlTab.DateOwner>20121129 150622</ChangeAndControlTab.DateOwner><ChangeAndControlTab.UserCreateId>005S0000003jTliIAE</ChangeAndControlTab.UserCreateId><ChangeAndControlTab.UserCreateName>Maxime Feron</ChangeAndControlTab.UserCreateName><ChangeAndControlTab.UserCreateGroup>System Administrator</ChangeAndControlTab.UserCreateGroup><ChangeAndControlTab.CreateDate>20121129 150622</ChangeAndControlTab.CreateDate><ChangeAndControlTab.LastUserUpdateId>005S0000003jTliIAE</ChangeAndControlTab.LastUserUpdateId><ChangeAndControlTab.LastUserUpdateName>Maxime Feron</ChangeAndControlTab.LastUserUpdateName><ChangeAndControlTab.LastUserUpdateGroup>System Administrator</ChangeAndControlTab.LastUserUpdateGroup><ChangeAndControlTab.LastUpdateDate>20121130 100533</ChangeAndControlTab.LastUpdateDate></fields><totalCells><Year1Total>0</Year1Total><Year2Total>0</Year2Total><Year3Total>0</Year3Total><Year4Total>0</Year4Total><Year5Total>0</Year5Total><DiscAmtYear1Total>0</DiscAmtYear1Total><DiscAmtYear2Total>0</DiscAmtYear2Total><DiscAmtYear3Total>0</DiscAmtYear3Total><DiscAmtYear4Total>0</DiscAmtYear4Total><DiscAmtYear5Total>0</DiscAmtYear5Total><Year1ListTotal>0</Year1ListTotal><Year2ListTotal>0</Year2ListTotal><Year3ListTotal>0</Year3ListTotal><Year4ListTotal>0</Year4ListTotal><Year5ListTotal>0</Year5ListTotal><ContractTotal>0</ContractTotal></totalCells><cartLines><cartLine id="1" type="CP7" subline="no" service="Collaborate" parent="0" seqNum="0"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode/><Description>Collaborate</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate</LongDescription><ProductStatus/><ProductCategory/><ProductFamily/><Qty>1</Qty><ContractStartDate>11/27/2012</ContractStartDate><ContractStartDateHidden>01022013</ContractStartDateHidden>      <ContractEndDate>11/26/2013</ContractEndDate><ContractEndDateHidden>01012018</ContractEndDateHidden>      <ContractLength>12 Months</ContractLength><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPriceCC>28030</ListPriceCC><ListPrice>59603.4</ListPrice><DiscAmt>1788.102</DiscAmt><DiscPct>3</DiscPct><NetPrice>57815.298</NetPrice><NetPriceCC>0</NetPriceCC><Renewable/><Platform/><isCore/><ParentItem/><HostedLocation/><isService/><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted/><isTandM/><ProductRequiresApproval/><isPerpetual/><isSFDC/><isComplete>true</isComplete><isPackage/><ParentPackage/><RenewBundle/><year>0</year><cartLines><cartLine id="2" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="1"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Web Conferencing Getting Started Online Training</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Getting Started Online Training</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>2700</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>81</DiscAmt><DiscPct>3</DiscPct><NetPrice>2619</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>false</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="3" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="2"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM Communicate and Collaborate - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM Communicate and Collaborate - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>1800</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>54</DiscAmt><DiscPct>3</DiscPct><NetPrice>1746</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>2</year></cartLine><cartLine id="4" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="3"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Collaborate Technical Considerations</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Collaborate Technical Considerations</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>3</year></cartLine><cartLine id="5" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="4"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Getting Started Implementation All</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Getting Started Implementation All</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>7200</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>216</DiscAmt><DiscPct>3</DiscPct><NetPrice>6984</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>4</year></cartLine><cartLine id="6" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="5"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-GS-WC</ProductCode><Description>Enterprise IM (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Enterprise IM (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>9702</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>291.06</DiscAmt><DiscPct>3</DiscPct><NetPrice>9410.94</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>5</year></cartLine><cartLine id="7" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="6"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TRNOL-WV-TCHG</ProductCode><Description>Teaching with Voice Authoring - Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Teaching with Voice Authoring - Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine><cartLine id="8" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="7"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-WC-FTE</ProductCode><Description>Web Conferencing (FTE)</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing (FTE)</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family Example</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0.1</Uplift><ListPrice>35501.4</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>1065.042</DiscAmt><DiscPct>3</DiscPct><NetPrice>34436.358</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>true</Renewable><Platform>Collaborate</Platform><isCore>true</isCore><ParentItem/><HostedLocation/><isService>false</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>true</isHosted><isTandM>true</isTandM><ProductRequiresApproval>true</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year/></cartLine><cartLine id="9" type="CP7" subline="yes" service="Collaborate" parent="1" seqNum="8"><bpDelayDate>1900-01-01T12:00:00.000-06:00</bpDelayDate><bpSplitType></bpSplitType><PartID/><ProductCode>CL-TECHOL-ADMIN</ProductCode><Description>Web Conferencing Admin Training Online</Description><bpMarket>HE</bpMarket><ItemSheet/><LongDescription>Web Conferencing Admin Training Online</LongDescription><ProductStatus>Renew</ProductStatus><ProductCategory/><ProductFamily>Product Family</ProductFamily><Qty>1</Qty><ContractStartDate/><ContractStartDateHidden>01022013</ContractStartDateHidden>          <ContractEndDate/><ContractEndDateHidden>01012018</ContractEndDateHidden>          <ContractLength/><ContractLengthHidden>12</ContractLengthHidden><Uplift>0</Uplift><ListPrice>900</ListPrice><ListPriceCC>28030</ListPriceCC><DiscAmt>27</DiscAmt><DiscPct>3</DiscPct><NetPrice>873</NetPrice><NetPriceCC>0</NetPriceCC><Renewable>false</Renewable><Platform>Collaborate</Platform><isCore>false</isCore><ParentItem/><HostedLocation/><isService>true</isService><RequiresDiscountApproval>true</RequiresDiscountApproval><RequiresTreasuryApproval/><isHosted>false</isHosted><isTandM>false</isTandM><ProductRequiresApproval>false</ProductRequiresApproval><isPerpetual>false</isPerpetual><isSFDC>true</isSFDC><isComplete>true</isComplete><isPackage>false</isPackage><ParentPackage/><RenewBundle/><year>1</year></cartLine></cartLines></cartLine></cartLines><eventHistory/><cartAdjustments/></cart>';
        String pricebookName = 'TEST_PB';
        String accName = 'TEST_ACC';
        String oppName = 'TEST_OPP';
        String quoteName = 'TEST_CAM_QUOTE';
        String attName = 'TEST_ATT_content';
        String prodName = 'CL-TRNOL-GS-WC';
        List<OpportunityTeamMember> oppteam = new List<OpportunityTeamMember> (); 
        List<OpportunityShare> sharesToCreate = new List<OpportunityShare>();
        List<Contact_Role__c> contactRolesCreate = new List<Contact_Role__c>();
        List<Contact_Role_Selector__c> contactSelectorCreate = new List<Contact_Role_Selector__c>(); 
  
          
        //create new account for testing
        Account accNew = TestMethodUtility.createAccount();
        insert accNew;     
        
        Pricebook2 spb = [select Id from Pricebook2 where IsActive=true and IsStandard=true LIMIT 1]; 
        Pricebook2 cpqPb = [select Id from Pricebook2 where Name='CPQ' LIMIT 1];
            
        Product2 prod = new Product2(Name = prodName, ProductCode = prodName);
        insert prod;
        
        PricebookEntry pbe = new PricebookEntry(Pricebook2Id = spb.Id, Product2Id = prod.Id, UnitPrice = 2, IsActive = true);
        insert pbe;
        
        //create renewal sales opp for testing
       // Opportunity oppRen=new Opportunity(Name=oppName,Start_Date__c=date.newinstance(2013, 2, 15),End_Date__c=date.newinstance(2014, 2, 14),RecordTypeId=renewId,CloseDate=System.now().date(),CPQ_Previous_Opportunity__c='006S0000006ou5kIAA',Pricebook2Id = spb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,Type='Renewal',Multi_Year_Deal__c='2 Year');
       // 
       
        Opportunity oppRen=new Opportunity(Name=oppName,Start_Date__c=date.newinstance(2014, 9, 15),End_Date__c=date.newinstance(2015, 9, 14),RecordTypeId=rec.id,CloseDate=System.now().date(),Pricebook2Id = spb.Id,StageName='(S) Suspect Qualification',AccountId=accNew.Id,Type='Renewal',Multi_Year_Deal__c='2 Year');
        insert oppRen;
        
        
       
        //Asset astNew = new Asset(Name='CL-TRNOL-GS-WC',CPQ_isMultiyear__c=true,CPQ_Net_Price__c=2,CurrencyIsoCode='USD',Description='testAsset',CPQ_Contract_End_Date__c=date.newinstance(2013, 2, 14),CPQ_Contract_Start_Date__c=date.newinstance(2012, 2, 15),AccountId=accNew.Id,CPQ_isRenewable__c=true,Status='Request Pending',CPQ_forCPQ__c=true,Price=1,Psft_Product_Id__c=prodName,Product2Id=prod.Id,CPQ_Current_Opportunity_ID__c=oppRen.Id,CPQ_currentYear__c=1,CPQ_contractLength__c=2,CPQ_NumQty__c=1,CPQ_LineIdentifier__c='145',CPQ_Active__c=true,CPQ_Selling_Exchange_Rate__c=1);
       // insert astNew;                     
      
        OpportunityLineItem oli = new OpportunityLineItem(CPQ_Year_2_Amount__c=100.00,CPQ_isRenewable__c=True,CPQ_NetPrice__c=1,CPQ_Product_End_Date__c=date.newinstance(2014, 2, 14),CPQ_Product_Start_Date__c=date.newinstance(2013, 2, 15),OpportunityId=oppRen.Id,Quantity=1, PricebookEntryId=pbe.Id,Renewal_Unique_Line_ID__c='145',CPQ_Product_Status__c='Renew',Custom_Price__c=0,CPQ_Delivery_Status__c='Request Pending',CPQ_Current_Opportunity_ID__c=oppRen.Id);
        insert oli;    
        
        Contact testContact = new Contact(LastName='Person',Accountid=accNew.id );
        insert testContact;
        
        //Insert 2 Contact Roles/Selectors to the Opportunity
        Contact_Role__c cr1 = new Contact_Role__c(Account__c= accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Contact');
        contactRolesCreate.add(cr1);
        
        Contact_Role__c cr2 = new Contact_Role__c(Account__c = accNew.Id, Contact__c = testContact.Id, Role__c = 'COLLABORATE - Primary Sales Technical Contact');
        contactRolesCreate.add(cr2);
        insert contactRolesCreate;
        
        Contact_Role_Selector__c crs1 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate.add(crs1);
        
        Contact_Role_Selector__c crs2 = new Contact_Role_Selector__c(Opportunity__c=oppRen.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate.add(crs2);
        insert contactSelectorCreate;
        
        User[] testUser = [SELECT Id FROM User where isActive = true limit 2];
        
        /*OpportunityShare oshare1 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[0].Id);
        sharesToCreate.add(oshare1);
        
        OpportunityShare oshare2 = new OpportunityShare(OpportunityAccessLevel = 'Read',OpportunityId=oppNew.Id,UserOrGroupId=testUser[1].Id);
        sharesToCreate.add(oshare2);
        
        insert sharesToCreate;*/
         
        OpportunityTeamMember oppMem1 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'New Sale Representative');
        oppMem1.UserId = testUser[0].Id;
        oppteam.add(oppMem1);
         
        OpportunityTeamMember oppMem2 = new OpportunityTeamMember(OpportunityId = oppRen.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem2.UserId = testUser[1].Id;
        oppteam.add(oppMem2);        
        insert oppteam;     
        
        CameleonCPQ__Quote__c  Camquote=TestMethodUtility.CreateCameleonQuote();
        Camquote.OpportunityId__c=oppRen.id;
      
        Insert  Camquote;  
       
        System.test.startTest();
        oppRen.StageName='(W) Won';
        oppRen.CloseDate=System.Today()+ 5;
        oppRen.Won_from__c='No Competitor';
        oppRen.CPQ_PO_Required__c='No';
        oppRen.Closed_Loss_Won_Reason__c='Budget';
        OppRen.ForecastCategoryName='Closed';
        OppRen.CPQActiveRelease__c=Camquote.id;
                
        update oppRen;
        Opportunity oppRendup =[Select id,Name,StageName,CPQ_Previous_Opportunity__c from Opportunity Where id =:oppRen.id ];
        oli.CPQ_Delivery_Status__c='Installed';
        update oli;
        
        System.debug('+++Nik+++' + oppRendup);
        //Added by Nikhil
        Opportunity opprenewl =[Select id,CPQ_Previous_Opportunity__c,CPQActiveRelease__c,StageName from Opportunity Where CPQ_Previous_Opportunity__c =: oppRendup.id];
        CameleonCPQ__Quote__c  Camquote1=[Select id from CameleonCPQ__Quote__c Where OpportunityId__c=:opprenewl.id];
        
        
        List<Contact_Role_Selector__c> contactSelectorCreate1 = New List<Contact_Role_Selector__c>();
        
        Contact_Role_Selector__c crs11 = new Contact_Role_Selector__c(Opportunity__c=opprenewl.Id, Contact_Role__c=cr1.Id);
        contactSelectorCreate1.add(crs11);
        
        Contact_Role_Selector__c crs22 = new Contact_Role_Selector__c(Opportunity__c=opprenewl.Id, Contact_Role__c=cr2.Id);
        contactSelectorCreate1.add(crs22);
        insert contactSelectorCreate1;
        
        List<OpportunityTeamMember> oppteam1 = New List<OpportunityTeamMember>();
        
        OpportunityTeamMember oppMem11 = new OpportunityTeamMember(OpportunityId = opprenewl.Id,TeamMemberRole = 'New Sale Representative');
        oppMem11.UserId = testUser[0].Id;
        oppteam1.add(oppMem1);
         
        OpportunityTeamMember oppMem22 = new OpportunityTeamMember(OpportunityId = opprenewl.Id,TeamMemberRole = 'Renewal Sale Representative');
        oppMem22.UserId = testUser[1].Id;
        oppteam1.add(oppMem2);        
        insert oppteam1;
        
        
        opprenewl.StageName='(W) Won';
        opprenewl.CPQActiveRelease__c=Camquote1.id;
        opprenewl.CPQ_PO_Required__c='No';
        
        Update opprenewl;
        
        
        
         
               
        System.test.stopTest();
    } 
    static testMethod void myunittesttocoverexception()
    {
        Account acc = TestMethodUtility.createAccount();
        insert acc;
        
        contact c= TestMethodUtility.createContact(acc);
        insert c;
        
        contact c3= TestMethodUtility.createContact(acc);
        c3.Email='testmail@abc.com';
        insert c3;
           
        Product2 pr =TestMethodUtility.createProduct();
        pr.Type__c='Services';
        insert pr;
        
        //Standard pricebook
        Pricebook2 standardPB = [select id from Pricebook2 where isStandard=true limit 1];
        
        Pricebook2 pb = [select Id from pricebook2 where Name='CPQ' limit 1];
        
        PricebookEntry pes = TestMethodUtility.createPricebookEntry(standardPB,pr);
        pes.UseStandardPrice = false;
        insert pes;
        
        PricebookEntry pe = TestMethodUtility.createPricebookEntry(pb,pr);
        pe.UseStandardPrice = false;
        insert pe;
       
        Opportunity op =TestMethodUtility.createOpportunity(acc,pb);
        op.Start_Date__c=date.newinstance(2014, 9, 15);
        op.End_Date__c=date.newinstance(2015, 9, 14);
        op.CloseDate=System.now().date();
        op.StageName='(S) Suspect Qualification';
        op.AccountId=acc.Id;
        op.Type='Renewal';
        op.Multi_Year_Deal__c='2 Year';
        insert op;
           
        OpportunityLineItem oli = new OpportunityLineItem(PricebookEntryId = pe.Id);
        oli.OpportunityId=op.id;
        oli.Quantity=1; 
        oli.CPQ_isRenewable__c=True;
        oli.CPQ_NetPrice__c=1;
        oli.CPQ_Product_End_Date__c=date.newinstance(2014, 2, 14);
        oli.CPQ_Product_Start_Date__c=date.newinstance(2013, 2, 15);
        oli.OpportunityId=op.Id;
        oli.Renewal_Unique_Line_ID__c='145';
        oli.CPQ_Product_Status__c='Renew';
        oli.Custom_Price__c=0;
        oli.CPQ_Delivery_Status__c='Request Pending';
        oli.CPQ_Current_Opportunity_ID__c=op.Id;
        insert oli;   
                 
        Contact_Role__c cr = TestMethodUtility.createContactRole(acc);
        cr.Contact__c=c.id;
        cr.Role__c='Multi-Platform - Primary Sales Technical Contact';
        insert cr;
        
        Contact_Role__c cr2 = TestMethodUtility.createContactRole(acc);
        cr2.Contact__c=c3.id;
        cr2.Role__c='Multi-Platform - Primary Sales Contact';
        insert cr2;
        
        Contact_Role_Selector__c crs = TestMethodUtility.createContactRoleSelector(cr);
        crs.Opportunity__c=op.id;
        insert crs;
        
        Contact_Role_Selector__c crs2 = TestMethodUtility.createContactRoleSelector(cr2);
        crs2.Opportunity__c=op.id;
        insert crs2;

        CameleonCPQ__Quote__c  Camquote=TestMethodUtility.CreateCameleonQuote();
        Camquote.OpportunityId__c=op.Id;
      
        Insert  Camquote;  

        System.test.startTest();
        
        oli.CPQ_Delivery_Status__c='Installed';
        update oli;
       
                
    }
    static testMethod void myunittestwithnoprods()
    {
        Account acc = TestMethodUtility.createAccount();
        insert acc;
        
        contact c= TestMethodUtility.createContact(acc);
        insert c;
        
        contact c3= TestMethodUtility.createContact(acc);
        c3.Email='testmail@abc.com';
        insert c3;
           
        Product2 pr =TestMethodUtility.createProduct();
        pr.Type__c='Services';
        insert pr;
        
        //Standard pricebook
        Pricebook2 standardPB = [select id from Pricebook2 where isStandard=true limit 1];
        
        Pricebook2 pb = [select Id from pricebook2 where Name='CPQ' limit 1];
        
        PricebookEntry pes = TestMethodUtility.createPricebookEntry(standardPB,pr);
        pes.UseStandardPrice = false;
        insert pes;
        
        PricebookEntry pe = TestMethodUtility.createPricebookEntry(pb,pr);
        pe.UseStandardPrice = false;
        insert pe;
       
        Opportunity op =TestMethodUtility.createOpportunity(acc,pb);
        insert op;
           
                         
        Contact_Role__c cr = TestMethodUtility.createContactRole(acc);
        cr.Contact__c=c.id;
        cr.Role__c='ANALYTICS - Primary Sales Technical Contact';
        insert cr;
        
        Contact_Role__c cr2 = TestMethodUtility.createContactRole(acc);
        cr2.Contact__c=c3.id;
        cr2.Role__c='ANALYTICS - Primary Sales Contact';
        insert cr2;
        
        Contact_Role_Selector__c crs = TestMethodUtility.createContactRoleSelector(cr);
        crs.Opportunity__c=op.id;
        insert crs;
        
        Contact_Role_Selector__c crs2 = TestMethodUtility.createContactRoleSelector(cr2);
        crs2.Opportunity__c=op.id;
        insert crs2;

        System.test.startTest();
        op.StageName='(W) Won';
        op.CloseDate=System.Today()+ 5;
        op.Won_from__c='No Competitor';
        op.CPQ_PO_Required__c='No';
        op.Closed_Loss_Won_Reason__c='Budget';
        Op.ForecastCategoryName='Closed';

        System.test.stopTest();
    }
}